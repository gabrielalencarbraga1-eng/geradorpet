<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuaPetição - Gerador de Petições com IA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-green-dark: #004d40;
            --primary-green-medium: #26a69a;
            --primary-green-light: #e0f2f1;
            --neutral-dark: #212121;
            --neutral-medium: #616161;
            --neutral-light: #f5f5f5;
            --background-color: #ffffff;
            --error-color: #d32f2f;
            --error-background: #ffebee;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--neutral-dark); font-size: 16px; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        header { background-color: var(--background-color); padding: 1rem 0; border-bottom: 1px solid #e0e0e0; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; transition: box-shadow 0.3s ease; }
        header.scrolled { box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary-green-dark); text-decoration: none; }
        .logo span { color: var(--primary-green-medium); }
        nav ul { display: flex; align-items: center; list-style: none; gap: 1.5rem; }
        nav a:not(.btn) { text-decoration: none; color: var(--neutral-medium); font-weight: 500; position: relative; transition: color 0.3s ease; padding: 0.5rem 0; }
        nav a:not(.btn):hover { color: var(--primary-green-dark); }
        nav a:not(.btn)::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; background-color: var(--primary-green-medium); transition: width 0.3s ease; }
        nav a:not(.btn):hover::after { width: 100%; }
        .hamburger { display: none; cursor: pointer; border: none; background: none; }
        .hamburger .bar { display: block; width: 25px; height: 3px; margin: 5px auto; background-color: var(--primary-green-dark); transition: all 0.3s ease-in-out; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 50px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-block; text-align: center; border: none; cursor: pointer; }
        .btn-primary { background-color: var(--primary-green-medium); color: white; box-shadow: 0 4px 15px rgba(38, 166, 154, 0.2); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(38, 166, 154, 0.3); }
        section { padding: 6rem 0; }
        .section-title { text-align: center; font-size: 2.5rem; font-weight: 700; color: var(--primary-green-dark); margin-bottom: 1rem; }
        .section-subtitle { text-align: center; font-size: 1.1rem; color: var(--neutral-medium); max-width: 600px; margin: 0 auto 4rem auto; }
        #hero { padding-top: 10rem; min-height: 100vh; display: flex; align-items: center; }
        .hero-content { display: flex; align-items: center; justify-content: space-between; gap: 2rem; }
        .hero-text { max-width: 55%; }
        .hero-text h1 { font-size: 3rem; font-weight: 700; line-height: 1.2; color: var(--primary-green-dark); margin-bottom: 1.5rem; }
        .hero-text p { font-size: 1.2rem; color: var(--neutral-medium); margin-bottom: 2.5rem; }
        .hero-image { max-width: 40%; }
        #how-it-works { background-color: var(--neutral-light); }
        .steps-container { display: flex; justify-content: space-around; gap: 2rem; margin-top: 4rem; }
        .step-card { background-color: white; padding: 2.5rem 2rem; border-radius: 10px; text-align: center; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease, box-shadow 0.3s ease; flex: 1; }
        .step-card:hover { transform: translateY(-10px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08); }
        .step-number { font-size: 2rem; font-weight: 700; color: var(--primary-green-medium); background-color: var(--primary-green-light); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem auto; }
        .step-card h3 { font-size: 1.5rem; color: var(--primary-green-dark); margin-bottom: 0.5rem; }
        .faq-item { border-bottom: 1px solid #e0e0e0; padding: 1.5rem 0; }
        .faq-question { display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-size: 1.2rem; font-weight: 600; }
        .faq-question:hover { color: var(--primary-green-medium); }
        .faq-answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, padding-top 0.3s ease-out; color: var(--neutral-medium); }
        .faq-answer p { padding-top: 0; }
        .faq-item.active .faq-answer { max-height: 500px; padding-top: 1rem; }
        .faq-toggle { font-size: 1.5rem; font-weight: bold; transition: transform 0.3s ease; }
        .faq-item.active .faq-toggle { transform: rotate(45deg); }
        #form-section { background-color: var(--neutral-light); }
        .form-container { background-color: white; padding: 3rem; border-radius: 10px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.07); max-width: 800px; margin: 0 auto; overflow: hidden; }
        .quiz-step { display: none; animation: fadeIn 0.5s ease-in-out; }
        .quiz-step.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .quiz-question { font-size: 1.75rem; font-weight: 600; color: var(--primary-green-dark); margin-bottom: 2rem; text-align: center; }
        .form-group { display: flex; flex-direction: column; margin-bottom: 1.5rem; }
        .form-group label { font-weight: 600; margin-bottom: 0.5rem; color: var(--primary-green-dark); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.8rem 1rem; border-radius: 8px; border: 1px solid #ccc; font-family: 'Poppins', sans-serif; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-green-medium); box-shadow: 0 0 0 3px rgba(38, 166, 154, 0.2); }
        .options-grid, .radio-options, .checkbox-options { display: flex; flex-direction: column; gap: 1rem; }
        .options-grid label, .radio-options label, .checkbox-options label { display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-weight: 500; padding: 1rem 1.5rem; border: 2px solid #ccc; border-radius: 8px; transition: all 0.2s ease; text-align: left; }
        .options-grid label:hover, .radio-options label:hover, .checkbox-options label:hover { border-color: var(--primary-green-medium); }
        .options-grid input[type="radio"], .radio-options input[type="radio"], .checkbox-options input[type="checkbox"] { display: none; }
        .options-grid input[type="radio"]:checked + label, .radio-options input[type="radio"]:checked + label, .checkbox-options input[type="checkbox"]:checked + label { border-color: var(--primary-green-medium); background-color: var(--primary-green-light); font-weight: 600; }
        .form-group.invalid .options-grid, .form-group.invalid .radio-options { border: 2px solid var(--error-color); border-radius: 8px; padding: 1rem; }
        .error-message { color: var(--error-color); font-size: 0.875rem; margin-top: 0.25rem; display: none; }
        .form-group.invalid .error-message { display: block; }
        .progress-container { margin-bottom: 2rem; position: relative; }
        .progress-bar-track { width: 100%; height: 10px; background-color: #e0e0e0; border-radius: 5px; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background-color: var(--primary-green-medium); border-radius: 5px; transition: width 0.4s ease; }
        .progress-text { text-align: center; margin-top: 0.5rem; color: var(--neutral-medium); font-weight: 500; }
        .quiz-navigation { display: flex; justify-content: space-between; margin-top: 3rem; }
        .quiz-navigation button { font-size: 1rem; }
        #result-screen { text-align: center; }
        #result-screen h3 { font-size: 2rem; color: var(--primary-green-dark); margin-bottom: 1rem; }
        #result-screen p { font-size: 1.1rem; color: var(--neutral-medium); margin-bottom: 2rem; }
        #result-screen ul { list-style: none; text-align: left; display: inline-block; margin-bottom: 2.5rem; }
        #result-screen ul li { font-size: 1.1rem; margin-bottom: 1rem; }
        footer { background-color: var(--primary-green-dark); color: white; padding: 3rem 0; text-align: center; }
        @media (max-width: 992px) { .hero-content { flex-direction: column; text-align: center; } .hero-text, .hero-image { max-width: 100%; } .steps-container { flex-direction: column; } }
        @media (max-width: 768px) { nav ul { position: fixed; left: -100%; top: 73px; flex-direction: column; background-color: white; width: 100%; text-align: center; transition: 0.3s; gap: 0; } nav ul.active { left: 0; } nav li, nav a { width: 100%; } .hamburger { display: block; } .hamburger.active .bar:nth-child(2) { opacity: 0; } .hamburger.active .bar:nth-child(1) { transform: translateY(8px) rotate(45deg); } .hamburger.active .bar:nth-child(3) { transform: translateY(-8px) rotate(-45deg); } }
    </style>
<script type="importmap">
{
  "imports": {
    "express": "https://aistudiocdn.com/express@^5.1.0",
    "cors": "https://aistudiocdn.com/cors@^2.8.5",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.28.0"
  }
}
</script>
</head>
<body>

    <header id="main-header">
        <div class="container header-content">
            <a href="#" class="logo">Sua<span>Petição</span></a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#how-it-works">Como funciona</a></li>
                    <li><a href="#faq">Perguntas Frequentes</a></li>
                    <li><a href="#form-section" class="btn btn-primary">Criar Petição Agora</a></li>
                </ul>
            </nav>
            <button class="hamburger"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>
        </div>
    </header>

    <main>
        <section id="hero">
            <div class="container hero-content">
                <div class="hero-text">
                    <h1>Gerador de Petições Iniciais com Inteligência Artificial</h1>
                    <p>Rápido, simples e pronto para protocolar no Juizado. Crie seu documento jurídico em minutos e defenda seus direitos com mais facilidade.</p>
                    <a href="#form-section" class="btn btn-primary">Criar Petição Agora</a>
                </div>
                <div class="hero-image">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#26A69A" d="M37.1,-45.7C51.2,-37.2,67.7,-27.1,73.5,-13.2C79.3,0.8,74.4,18.5,64.8,32.1C55.2,45.7,40.8,55.1,25.9,61.1C10.9,67.1,-4.7,69.7,-20.1,65.8C-35.5,61.9,-50.7,51.5,-60.7,37.8C-70.8,24.1,-75.7,7.1,-72.7,-8.4C-69.7,-23.9,-58.8,-37.9,-46,-46.8C-33.2,-55.7,-18.5,-59.5,-4.6,-56.9C9.4,-54.3,23,-45.7,37.1,-45.7Z" transform="translate(100 100)" />
                    </svg>
                </div>
            </div>
        </section>

        <section id="how-it-works">
            <div class="container">
                <h2 class="section-title">Como Funciona?</h2>
                <p class="section-subtitle">Em 3 passos simples, você transforma seu problema em um documento jurídico completo.</p>
                <div class="steps-container">
                    <div class="step-card"><div class="step-number">1</div><h3>Responda o Quiz</h3><p>Nossa IA faz perguntas simples e diretas para entender todos os detalhes do seu caso.</p></div>
                    <div class="step-card"><div class="step-number">2</div><h3>IA Redige a Petição</h3><p>Com base nas suas respostas, a IA monta um documento completo, com fatos, fundamentos e pedidos.</p></div>
                    <div class="step-card"><div class="step-number">3</div><h3>Baixe e Protocole</h3><p>Você recebe o arquivo PDF pronto. Basta imprimir e levar ao Juizado Especial da sua cidade.</p></div>
                </div>
            </div>
        </section>

        <section id="form-section">
            <div class="container">
                <h2 class="section-title">Crie Sua Petição</h2>
                <p class="section-subtitle">Responda algumas perguntas e nossa IA montará o documento para você.</p>
                <div class="form-container">
                    <form id="petition-form" style="display: block;">
                        <div class="progress-container">
                             <div class="progress-bar-track"><div class="progress-bar-fill"></div></div>
                            <p class="progress-text">Pergunta 1 de 9</p>
                        </div>

                        <div class="quiz-step active" data-step-id="problem-type">
                            <h3 class="quiz-question">Primeiro, qual é o seu problema principal?</h3>
                            <div class="form-group" required>
                                <div class="radio-options">
                                    <input type="radio" id="corte_energia" name="problem-type" value="corte_energia" required><label for="corte_energia">Corte indevido de energia</label>
                                    <input type="radio" id="danos_eletricos" name="problem-type" value="danos_eletricos" required><label for="danos_eletricos">Oscilação/queda que danificou aparelhos</label>
                                    <input type="radio" id="toi" name="problem-type" value="toi" required><label for="toi">Multa / TOI indevido</label>
                                    <input type="radio" id="recusa_ligacao" name="problem-type" value="recusa_ligacao" required><label for="recusa_ligacao">Recusa na ligação de nova energia</label>
                                    <input type="radio" id="cobranca_indevida" name="problem-type" value="cobranca_indevida" required><label for="cobranca_indevida">Cobrança indevida na conta</label>
                                </div>
                                <div class="error-message">Por favor, selecione uma opção.</div>
                            </div>
                        </div>

                        <div class="quiz-step" data-step-id="author-name"><h3 class="quiz-question">Qual é o seu nome completo?</h3><div class="form-group"><input type="text" id="author-name" name="author-name" placeholder="Digite seu nome completo" required></div></div>
                        <div class="quiz-step" data-step-id="author-cpf"><h3 class="quiz-question">E o seu CPF?</h3><div class="form-group"><input type="text" id="author-cpf" name="author-cpf" placeholder="Digite seu CPF" required></div></div>
                        <div class="quiz-step" data-step-id="author-address"><h3 class="quiz-question">Qual seu endereço completo?</h3><div class="form-group"><input type="text" id="author-address" name="author-address" placeholder="Rua, Número, Bairro, Cidade, Estado, CEP" required></div></div>
                        <div class="quiz-step" data-step-id="author-contact"><h3 class="quiz-question">Para finalizar seus dados, qual seu e-mail e telefone?</h3><div class="form-group"><input type="email" id="author-email" name="author-email" placeholder="seu@email.com" required></div><div class="form-group"><input type="tel" id="author-phone" name="author-phone" placeholder="(XX) XXXXX-XXXX" required></div></div>
                        <div class="quiz-step" data-step-id="company-name"><h3 class="quiz-question">Qual o nome da concessionária de energia?</h3><div class="form-group"><input type="text" id="company-name" name="company-name" placeholder="Ex: Coelba, Enel, Light, etc." required></div></div>
                        
                        <div class="quiz-step" data-step-id="corte-data"><h3 class="quiz-question">Em que data a energia foi cortada?</h3><div class="form-group"><input type="date" id="corte-data" name="corte-data" required></div></div>
                        <div class="quiz-step" data-step-id="corte-religacao"><h3 class="quiz-question">Quando a energia foi religada (se já foi)?</h3><div class="form-group"><input type="date" id="corte-religacao" name="corte-religacao"></div></div>
                        <div class="quiz-step" data-step-id="oscilacao-data"><h3 class="quiz-question">Qual foi o dia da oscilação ou queda de energia?</h3><div class="form-group"><input type="date" id="oscilacao-data" name="oscilacao-data" required></div></div>
                        <div class="quiz-step" data-step-id="oscilacao-equipamentos"><h3 class="quiz-question">Quais equipamentos foram danificados?</h3><div class="form-group"><textarea id="oscilacao-equipamentos" name="oscilacao-equipamentos" placeholder="Ex: TV Samsung 50 polegadas (R$ 2.500), Geladeira Brastemp (R$ 3.000)" required></textarea></div></div>
                        
                        <div class="quiz-step" data-step-id="valores-pedidos">
                            <h3 class="quiz-question">Você quer pedir indenização por danos morais?</h3>
                            <div class="form-group">
                                <div class="radio-options">
                                    <input type="radio" id="dano-moral-sim" name="dano-moral-pergunta" value="sim"><label for="dano-moral-sim">Sim, quero pedir</label>
                                    <input type="radio" id="dano-moral-nao" name="dano-moral-pergunta" value="nao" checked><label for="dano-moral-nao">Não, por enquanto</label>
                                </div>
                            </div>
                            <div class="form-group" id="dano-moral-valor-group" style="display: none;">
                                <label for="moral-value">Se quiser, indique um valor sugerido para danos morais (opcional)</label>
                                <input type="text" id="moral-value" name="moral-value" placeholder="R$ 5.000,00">
                            </div>
                            <div class="form-group">
                                <label for="material-value">Qual o valor total aproximado dos seus prejuízos materiais?</label>
                                <input type="text" id="material-value" name="material-value" placeholder="R$ 0,00">
                            </div>
                        </div>

                        <div class="quiz-step" data-step-id="action-city-state"><h3 class="quiz-question">Estamos quase no fim! Em qual cidade e estado você vai entrar com a ação?</h3><div class="form-group"><input type="text" id="action-city-state" name="action-city-state" placeholder="Ex: Salvador, Bahia" required></div></div>
                        
                        <div class="quiz-navigation">
                            <button type="button" id="prevBtn" class="btn">Anterior</button>
                            <button type="button" id="nextBtn" class="btn btn-primary">Próximo</button>
                        </div>
                    </form>

                    <div id="result-screen" style="display: none;">
                        <h3>Petição Gerada com Sucesso!</h3>
                        <p>Seu documento foi baixado. Siga os próximos passos para protocolar sua ação:</p>
                        <ul>
                            <li>✅ Abra o arquivo 'peticao.pdf' que foi salvo no seu computador.</li>
                            <li>✅ Imprima 3 vias do documento.</li>
                            <li>✅ Junte cópias dos seus documentos pessoais (RG, CPF, Comprovante de Residência).</li>
                            <li>✅ Anexe todas as provas que você mencionou (notas fiscais, protocolos, prints, etc).</li>
                            <li>✅ Leve toda a documentação ao balcão do Juizado Especial Cível (JEC) da sua cidade.</li>
                        </ul>
                        <button type="button" id="restart-quiz-btn" class="btn btn-primary">Começar Novamente</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="faq">
            <div class="container">
                <h2 class="section-title">Perguntas Frequentes</h2>
                <div class="faq-item"><div class="faq-question"><span>Quanto custa?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>A geração da sua petição inicial é totalmente gratuita. Nosso objetivo é democratizar o acesso à justiça.</p></div></div>
                <div class="faq-item"><div class="faq-question"><span>Preciso de advogado?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>Para causas no Juizado Especial Cível de até 20 salários mínimos, você não precisa de advogado. Nossa ferramenta foca em criar documentos para estes casos.</p></div></div>
                <div class="faq-item"><div class="faq-question"><span>Meus dados estão seguros?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>Sim. Não armazenamos nenhuma informação pessoal que você insere no formulário. Todos os dados são usados apenas para gerar o documento e são descartados em seguida.</p></div></div>
                <div class="faq-item"><div class="faq-question"><span>Gerei a petição. E agora?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>Após baixar o PDF, você deve imprimi-lo, juntar cópias dos seus documentos pessoais e de todas as provas que tiver (contas, protocolos, fotos), e levar tudo ao Juizado Especial Cível (JEC) da sua cidade para dar entrada no processo.</p></div></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 SuaPetição. Todos os direitos reservados. Este site não presta assessoria jurídica.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Edite esta linha com a URL do seu backend do Render
            const API_URL = "https://SEU-BACKEND.onrender.com/api/generate-petition";

            // --- Lógica do Header e Menu ---
            const header = document.getElementById('main-header');
            window.addEventListener('scroll', () => {
                header.classList.toggle('scrolled', window.scrollY > 50);
            });
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
                    if (navMenu.classList.contains('active')) {
                        hamburger.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });
            });

            // --- Lógica do FAQ ---
            const faqItems = document.querySelectorAll('.faq-item');
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                question.addEventListener('click', () => {
                    const isActive = item.classList.contains('active');
                    faqItems.forEach(i => i.classList.remove('active'));
                    if (!isActive) {
                        item.classList.add('active');
                    }
                });
            });

            // --- Lógica do Quiz ---
            const form = document.getElementById('petition-form');
            const resultScreen = document.getElementById('result-screen');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const progressBarFill = document.querySelector('.progress-bar-fill');
            const progressText = document.querySelector('.progress-text');
            const allSteps = Array.from(document.querySelectorAll('.quiz-step'));
            
            const stepBlocks = {
                corte_energia: ['corte-data', 'corte-religacao'],
                danos_eletricos: ['oscilacao-data', 'oscilacao-equipamentos'],
                toi: [],
                recusa_ligacao: [],
                cobranca_indevida: [],
            };

            let quizFlow = [];
            let currentStepIndex = 0;

            function startQuiz() {
                quizFlow = [
                    'problem-type', 'author-name', 'author-cpf', 'author-address', 
                    'author-contact', 'company-name', 'valores-pedidos', 'action-city-state'
                ];
                currentStepIndex = 0;
                allSteps.forEach(s => s.classList.remove('active'));
                const firstStep = allSteps.find(s => s.dataset.stepId === quizFlow[0]);
                if (firstStep) firstStep.classList.add('active');
                updateProgress();
                updateNavigationButtons();
            }

            function updateQuizFlow() {
                const formData = new FormData(form);
                const problemType = formData.get('problem-type');
                
                let baseFlow = [
                    'problem-type', 'author-name', 'author-cpf', 'author-address', 
                    'author-contact', 'company-name', 'valores-pedidos', 'action-city-state'
                ];
                
                if (problemType && stepBlocks[problemType]) {
                    const companyIndex = baseFlow.indexOf('company-name');
                    if (companyIndex !== -1) {
                        baseFlow.splice(companyIndex + 1, 0, ...stepBlocks[problemType]);
                    }
                }
                quizFlow = baseFlow;
            }

            function showStep(index) {
                allSteps.forEach(step => step.classList.remove('active'));
                const stepIdToShow = quizFlow[index];
                const stepElement = allSteps.find(s => s.dataset.stepId === stepIdToShow);
                if (stepElement) {
                    stepElement.classList.add('active');
                }
                updateProgress();
                updateNavigationButtons();
            }
            
            function updateProgress() {
                const totalSteps = quizFlow.length || 1;
                const progressPercentage = Math.max(0, (currentStepIndex / (totalSteps - 1))) * 100;
                progressBarFill.style.width = `${progressPercentage}%`;
                progressText.textContent = `Pergunta ${currentStepIndex + 1} de ${totalSteps}`;
            }

            function updateNavigationButtons() {
                prevBtn.style.visibility = currentStepIndex === 0 ? 'hidden' : 'visible';
                nextBtn.textContent = currentStepIndex === quizFlow.length - 1 ? 'Gerar Petição' : 'Próximo';
            }
            
            function validateCurrentStep() {
                let isValid = true;
                const currentStepId = quizFlow[currentStepIndex];
                const currentStepElement = allSteps.find(s => s.dataset.stepId === currentStepId);

                currentStepElement.querySelectorAll('[required]').forEach(input => {
                    const formGroup = input.closest('.form-group');
                    let isFieldValid = true;

                    if (input.type === 'radio' || input.type === 'checkbox') {
                        if (!currentStepElement.querySelector(`input[name="${input.name}"]:checked`)) {
                            isFieldValid = false;
                        }
                    } else if (!input.value.trim()) {
                        isFieldValid = false;
                    }

                    if (!isFieldValid) {
                        isValid = false;
                        if (formGroup) formGroup.classList.add('invalid');
                    } else {
                        if (formGroup) formGroup.classList.remove('invalid');
                    }
                });
                return isValid;
            }

            async function submitForm() {
                nextBtn.textContent = 'Gerando...';
                nextBtn.disabled = true;

                const formData = new FormData(form);
                const data = {};
                formData.forEach((value, key) => {
                    if (data[key]) {
                        if (!Array.isArray(data[key])) data[key] = [data[key]];
                        data[key].push(value);
                    } else { data[key] = value; }
                });

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data),
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error || 'Erro no servidor. Verifique o log do seu backend no Render para mais detalhes.');
                    }

                    const result = await response.json();
                    const petitionText = result.text || '';

                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF({ orientation: 'p', unit: 'mm', format: 'a4' });
                    const margin = 20;
                    const maxWidth = doc.internal.pageSize.width - margin * 2;
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(12);
                    const lines = doc.splitTextToSize(petitionText, maxWidth);
                    doc.text(lines, margin, margin);
                    doc.save('peticao.pdf');

                    form.style.display = 'none';
                    resultScreen.style.display = 'block';

                } catch (error) {
                    console.error("Falha ao gerar petição:", error);
                    alert("Ocorreu um erro ao gerar a petição: " + error.message);
                } finally {
                    nextBtn.textContent = currentStepIndex === quizFlow.length - 1 ? 'Gerar Petição' : 'Próximo';
                    nextBtn.disabled = false;
                }
            }

            nextBtn.addEventListener('click', () => {
                if (!validateCurrentStep()) return;
                
                const oldFlowLength = quizFlow.length;
                updateQuizFlow();
                const newFlowLength = quizFlow.length;

                if(currentStepIndex === 0 && newFlowLength !== oldFlowLength){
                     updateProgress();
                }

                if (currentStepIndex === quizFlow.length - 1) {
                    submitForm();
                } else {
                    currentStepIndex++;
                    showStep(currentStepIndex);
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentStepIndex > 0) {
                    currentStepIndex--;
                    showStep(currentStepIndex);
                }
            });
            
            document.getElementById('restart-quiz-btn').addEventListener('click', () => {
                resultScreen.style.display = 'none';
                form.style.display = 'block';
                form.reset();
                startQuiz();
            });
            
            const danoMoralRadio = document.querySelectorAll('input[name="dano-moral-pergunta"]');
            const danoMoralValueGroup = document.getElementById('dano-moral-valor-group');
            danoMoralRadio.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    danoMoralValueGroup.style.display = e.target.value === 'sim' ? 'block' : 'none';
                });
            });

            startQuiz();
        });
    </script>
</body>
</html>
